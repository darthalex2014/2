(function(){"use strict";var de=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function se(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fe={exports:{}};(function(e,r){(function(t,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:de,function(t){var n,i;if(!((i=(n=globalThis.chrome)==null?void 0:n.runtime)!=null&&i.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const l="The message port closed before a response was received.",o=g=>{const u={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(u).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class b extends WeakMap{constructor(a,m=void 0){super(m),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const d=s=>s&&typeof s=="object"&&typeof s.then=="function",C=(s,a)=>(...m)=>{g.runtime.lastError?s.reject(new Error(g.runtime.lastError.message)):a.singleCallbackArg||m.length<=1&&a.singleCallbackArg!==!1?s.resolve(m[0]):s.resolve(m)},P=s=>s==1?"argument":"arguments",T=(s,a)=>function(A,...p){if(p.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${P(a.minArgs)} for ${s}(), got ${p.length}`);if(p.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${P(a.maxArgs)} for ${s}(), got ${p.length}`);return new Promise((h,w)=>{if(a.fallbackToNoCallback)try{A[s](...p,C({resolve:h,reject:w},a))}catch(c){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,c),A[s](...p),a.fallbackToNoCallback=!1,a.noCallback=!0,h()}else a.noCallback?(A[s](...p),h()):A[s](...p,C({resolve:h,reject:w},a))})},E=(s,a,m)=>new Proxy(a,{apply(A,p,h){return m.call(p,s,...h)}});let k=Function.call.bind(Object.prototype.hasOwnProperty);const _=(s,a={},m={})=>{let A=Object.create(null),p={has(w,c){return c in s||c in A},get(w,c,y){if(c in A)return A[c];if(!(c in s))return;let f=s[c];if(typeof f=="function")if(typeof a[c]=="function")f=E(s,s[c],a[c]);else if(k(m,c)){let N=T(c,m[c]);f=E(s,s[c],N)}else f=f.bind(s);else if(typeof f=="object"&&f!==null&&(k(a,c)||k(m,c)))f=_(f,a[c],m[c]);else if(k(m,"*"))f=_(f,a[c],m["*"]);else return Object.defineProperty(A,c,{configurable:!0,enumerable:!0,get(){return s[c]},set(N){s[c]=N}}),f;return A[c]=f,f},set(w,c,y,f){return c in A?A[c]=y:s[c]=y,!0},defineProperty(w,c,y){return Reflect.defineProperty(A,c,y)},deleteProperty(w,c){return Reflect.deleteProperty(A,c)}},h=Object.create(s);return new Proxy(h,p)},F=s=>({addListener(a,m,...A){a.addListener(s.get(m),...A)},hasListener(a,m){return a.hasListener(s.get(m))},removeListener(a,m){a.removeListener(s.get(m))}}),U=new b(s=>typeof s!="function"?s:function(m){const A=_(m,{},{getContent:{minArgs:0,maxArgs:0}});s(A)}),L=new b(s=>typeof s!="function"?s:function(m,A,p){let h=!1,w,c=new Promise(O=>{w=function(v){h=!0,O(v)}}),y;try{y=s(m,A,w)}catch(O){y=Promise.reject(O)}const f=y!==!0&&d(y);if(y!==!0&&!f&&!h)return!1;const N=O=>{O.then(v=>{p(v)},v=>{let z;v&&(v instanceof Error||typeof v.message=="string")?z=v.message:z="An unexpected error occurred",p({__mozWebExtensionPolyfillReject__:!0,message:z})}).catch(v=>{console.error("Failed to send onMessage rejected reply",v)})};return N(f?y:c),!0}),Ae=({reject:s,resolve:a},m)=>{g.runtime.lastError?g.runtime.lastError.message===l?a():s(new Error(g.runtime.lastError.message)):m&&m.__mozWebExtensionPolyfillReject__?s(new Error(m.message)):a(m)},J=(s,a,m,...A)=>{if(A.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${P(a.minArgs)} for ${s}(), got ${A.length}`);if(A.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${P(a.maxArgs)} for ${s}(), got ${A.length}`);return new Promise((p,h)=>{const w=Ae.bind(null,{resolve:p,reject:h});A.push(w),m.sendMessage(...A)})},ue={devtools:{network:{onRequestFinished:F(U)}},runtime:{onMessage:F(L),onMessageExternal:F(L),sendMessage:J.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:J.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},B={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return u.privacy={network:{"*":B},services:{"*":B},websites:{"*":B}},_(g,ue,u)};t.exports=o(chrome)}else t.exports=globalThis.browser})})(fe);var Pe=fe.exports;const I=se(Pe);var ne={exports:{}};const Re=e=>typeof crypto<"u"&&typeof crypto.getRandomValues=="function"?()=>{const r=crypto.getRandomValues(new Uint8Array(1))[0];return(r>=e?r%e:r).toString(e)}:()=>Math.floor(Math.random()*e).toString(e),pe=(e=7,r=!1)=>Array.from({length:e},Re(r?16:36)).join("");ne.exports=pe,ne.exports.default=pe;var Me=ne.exports;const Y=se(Me);var Ne=()=>`uid::${Y(7)}`,Oe=(e,r=["endpointName","fingerprint"])=>typeof e=="object"&&e!==null&&r.every(t=>t in e),$e=e=>{try{const r=JSON.parse(e);return Oe(r)?r:null}catch{return null}},Fe=()=>{let e=[];return{add:(...r)=>{e=[...e,...r]},remove:r=>{e=typeof r=="string"?e.filter(t=>t.message.transactionId!==r):e.filter(t=>!r.includes(t))},entries:()=>e}},q=class{static toBackground(e,r){return e.postMessage(r)}static toExtensionContext(e,r){return e.postMessage(r)}},Le=Object.defineProperty,De=Object.defineProperties,je=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,be=(e,r,t)=>r in e?Le(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,$=(e,r)=>{for(var t in r||(r={}))Ue.call(r,t)&&be(e,t,r[t]);if(xe)for(var t of xe(r))Be.call(r,t)&&be(e,t,r[t]);return e},ae=(e,r)=>De(e,je(r)),ze=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,oe=e=>{const[,r,t,n]=e.match(ze)||[];return{context:r,tabId:+t,frameId:n?+n:void 0}},K=({context:e,tabId:r,frameId:t})=>["background","popup","options"].includes(e)?e:`${e}@${r}${t?`.${t}`:""}`;const We=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],ie=Symbol(".toJSON was called"),Ve=e=>{e[ie]=!0;const r=e.toJSON();return delete e[ie],r},he=({from:e,seen:r,to_:t,forceEnumerable:n,maxDepth:i,depth:l})=>{const o=t||(Array.isArray(e)?[]:{});if(r.push(e),l>=i)return o;if(typeof e.toJSON=="function"&&e[ie]!==!0)return Ve(e);for(const[g,u]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(u)){o[g]="[object Buffer]";continue}if(u!==null&&typeof u=="object"&&typeof u.pipe=="function"){o[g]="[object Stream]";continue}if(typeof u!="function"){if(!u||typeof u!="object"){o[g]=u;continue}if(!r.includes(e[g])){l++,o[g]=he({from:e[g],seen:[...r],forceEnumerable:n,maxDepth:i,depth:l});continue}o[g]="[Circular]"}}for(const{property:g,enumerable:u}of We)typeof e[g]=="string"&&Object.defineProperty(o,g,{value:e[g],enumerable:n?!0:u,configurable:!0,writable:!0});return o};function qe(e,r={}){const{maxDepth:t=Number.POSITIVE_INFINITY}=r;return typeof e=="object"&&e!==null?he({from:e,seen:[],forceEnumerable:!0,maxDepth:t,depth:0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}let we=()=>({events:{},emit(e,...r){(this.events[e]||[]).forEach(t=>t(...r))},on(e,r){return(this.events[e]=this.events[e]||[]).push(r),()=>this.events[e]=(this.events[e]||[]).filter(t=>t!==r)}});var Ge=(e,r,t)=>{const n=Y(),i=new Map,l=new Map,o=g=>{if(g.destination.context===e&&!g.destination.frameId&&!g.destination.tabId){t==null||t(g);const{transactionId:u,messageID:b,messageType:d}=g,C=()=>{const T=i.get(u);if(T){const{err:E,data:k}=g;if(E){const _=E,F=self[_.name],U=new(typeof F=="function"?F:Error)(_.message);for(const L in _)U[L]=_[L];T.reject(U)}else T.resolve(k);i.delete(u)}},P=async()=>{let T,E,k=!1;try{const _=l.get(b);if(typeof _=="function")T=await _({sender:g.origin,id:b,data:g.data,timestamp:g.timestamp});else throw k=!0,new Error(`[webext-bridge] No handler registered in '${e}' to accept messages with id '${b}'`)}catch(_){E=_}finally{if(E&&(g.err=qe(E)),o(ae($({},g),{messageType:"reply",data:T,origin:{context:e,tabId:null},destination:g.origin,hops:[]})),E&&!k)throw T}};switch(d){case"reply":return C();case"message":return P()}}return g.hops.push(`${e}::${n}`),r(g)};return{handleMessage:o,endTransaction:g=>{const u=i.get(g);u==null||u.reject("Transaction was ended before it could complete"),i.delete(g)},sendMessage:(g,u,b="background")=>{const d=typeof b=="string"?oe(b):b,C="Bridge#sendMessage ->";if(!d.context)throw new TypeError(`${C} Destination must be any one of known destinations`);return new Promise((P,T)=>{const E={messageID:g,data:u,destination:d,messageType:"message",transactionId:Y(),origin:{context:e,tabId:null},hops:[],timestamp:Date.now()};i.set(E.transactionId,{resolve:P,reject:T});try{o(E)}catch(k){i.delete(E.transactionId),T(k)}})},onMessage:(g,u)=>(l.set(g,u),()=>l.delete(g))}},W=class{constructor(e,r){this.endpointRuntime=e,this.streamInfo=r,this.emitter=we(),this.isClosed=!1,this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.events={})},W.initDone||(e.onMessage("__crx_bridge_stream_transfer__",t=>{const{streamId:n,streamTransfer:i,action:l}=t.data,o=W.openStreams.get(n);o&&!o.isClosed&&(l==="transfer"&&o.emitter.emit("message",i),l==="close"&&(W.openStreams.delete(n),o.handleStreamClose()))}),W.initDone=!0),W.openStreams.set(this.streamInfo.streamId,this)}get info(){return this.streamInfo}send(e){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:e,action:"transfer"},this.streamInfo.endpoint)}close(e){e&&this.send(e),this.handleStreamClose(),this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:null,action:"close"},this.streamInfo.endpoint)}onMessage(e){return this.getDisposable("message",e)}onClose(e){return this.getDisposable("closed",e)}getDisposable(e,r){const t=this.emitter.on(e,r);return Object.assign(t,{dispose:t,close:t})}},X=W;X.initDone=!1,X.openStreams=new Map;var He=e=>{const r=new Map,t=new Map,n=we();e.onMessage("__crx_bridge_stream_open__",o=>new Promise(g=>{const{sender:u,data:b}=o,{channel:d}=b;let C=!1,P=()=>{};const T=()=>{const E=t.get(d);typeof E=="function"?(E(new X(e,ae($({},b),{endpoint:u}))),C&&P(),g(!0)):C||(C=!0,P=n.on("did-change-stream-callbacks",T))};T()}));async function i(o,g){if(r.has(o))throw new Error("webext-bridge: A Stream is already open at this channel");const u=typeof g=="string"?oe(g):g,b={streamId:Y(),channel:o,endpoint:u},d=new X(e,b);return d.onClose(()=>r.delete(o)),await e.sendMessage("__crx_bridge_stream_open__",b,u),r.set(o,d),d}function l(o,g){if(t.has(o))throw new Error("webext-bridge: This channel has already been claimed. Stream allows only one-on-one communication");t.set(o,g),n.emit("did-change-stream-callbacks")}return{openStream:i,onOpenStreamChannel:l}},ye={exports:{}};(function(e,r){(function(t,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:de,function(t){if(typeof globalThis!="object"||typeof chrome!="object"||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const n="The message port closed before a response was received.",i="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",l=o=>{const g={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(g).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class u extends WeakMap{constructor(a,m=void 0){super(m),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const b=s=>s&&typeof s=="object"&&typeof s.then=="function",d=(s,a)=>(...m)=>{o.runtime.lastError?s.reject(new Error(o.runtime.lastError.message)):a.singleCallbackArg||m.length<=1&&a.singleCallbackArg!==!1?s.resolve(m[0]):s.resolve(m)},C=s=>s==1?"argument":"arguments",P=(s,a)=>function(A,...p){if(p.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${C(a.minArgs)} for ${s}(), got ${p.length}`);if(p.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${C(a.maxArgs)} for ${s}(), got ${p.length}`);return new Promise((h,w)=>{if(a.fallbackToNoCallback)try{A[s](...p,d({resolve:h,reject:w},a))}catch(c){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,c),A[s](...p),a.fallbackToNoCallback=!1,a.noCallback=!0,h()}else a.noCallback?(A[s](...p),h()):A[s](...p,d({resolve:h,reject:w},a))})},T=(s,a,m)=>new Proxy(a,{apply(A,p,h){return m.call(p,s,...h)}});let E=Function.call.bind(Object.prototype.hasOwnProperty);const k=(s,a={},m={})=>{let A=Object.create(null),p={has(w,c){return c in s||c in A},get(w,c,y){if(c in A)return A[c];if(!(c in s))return;let f=s[c];if(typeof f=="function")if(typeof a[c]=="function")f=T(s,s[c],a[c]);else if(E(m,c)){let N=P(c,m[c]);f=T(s,s[c],N)}else f=f.bind(s);else if(typeof f=="object"&&f!==null&&(E(a,c)||E(m,c)))f=k(f,a[c],m[c]);else if(E(m,"*"))f=k(f,a[c],m["*"]);else return Object.defineProperty(A,c,{configurable:!0,enumerable:!0,get(){return s[c]},set(N){s[c]=N}}),f;return A[c]=f,f},set(w,c,y,f){return c in A?A[c]=y:s[c]=y,!0},defineProperty(w,c,y){return Reflect.defineProperty(A,c,y)},deleteProperty(w,c){return Reflect.deleteProperty(A,c)}},h=Object.create(s);return new Proxy(h,p)},_=s=>({addListener(a,m,...A){a.addListener(s.get(m),...A)},hasListener(a,m){return a.hasListener(s.get(m))},removeListener(a,m){a.removeListener(s.get(m))}}),F=new u(s=>typeof s!="function"?s:function(m){const A=k(m,{},{getContent:{minArgs:0,maxArgs:0}});s(A)});let U=!1;const L=new u(s=>typeof s!="function"?s:function(m,A,p){let h=!1,w,c=new Promise(O=>{w=function(v){U||(console.warn(i,new Error().stack),U=!0),h=!0,O(v)}}),y;try{y=s(m,A,w)}catch(O){y=Promise.reject(O)}const f=y!==!0&&b(y);if(y!==!0&&!f&&!h)return!1;const N=O=>{O.then(v=>{p(v)},v=>{let z;v&&(v instanceof Error||typeof v.message=="string")?z=v.message:z="An unexpected error occurred",p({__mozWebExtensionPolyfillReject__:!0,message:z})}).catch(v=>{console.error("Failed to send onMessage rejected reply",v)})};return N(f?y:c),!0}),Ae=({reject:s,resolve:a},m)=>{o.runtime.lastError?o.runtime.lastError.message===n?a():s(new Error(o.runtime.lastError.message)):m&&m.__mozWebExtensionPolyfillReject__?s(new Error(m.message)):a(m)},J=(s,a,m,...A)=>{if(A.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${C(a.minArgs)} for ${s}(), got ${A.length}`);if(A.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${C(a.maxArgs)} for ${s}(), got ${A.length}`);return new Promise((p,h)=>{const w=Ae.bind(null,{resolve:p,reject:h});A.push(w),m.sendMessage(...A)})},ue={devtools:{network:{onRequestFinished:_(F)}},runtime:{onMessage:_(L),onMessageExternal:_(L),sendMessage:J.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:J.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},B={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return g.privacy={network:{"*":B},services:{"*":B},websites:{"*":B}},k(o,ue,g)};t.exports=l(chrome)}else t.exports=globalThis.browser})})(ye);var Ze=ye.exports;const Je=se(Ze);var G=Fe(),R=new Map,V=new Map,Q=new Map,Ee=(e,r)=>(V.set(e,(V.get(e)||new Set).add(r)),()=>{const t=V.get(e);t!=null&&t.delete(r)&&(t==null?void 0:t.size)===0&&V.delete(e)}),ve=(e,r)=>{Q.set(e,(Q.get(e)||new Set).add(r))},D=e=>({withFingerprint:r=>{const t=i=>({and:()=>i}),n={aboutIncomingMessage:i=>{const l=R.get(e);return q.toExtensionContext(l.port,{status:"incoming",message:i}),t(n)},aboutSuccessfulDelivery:i=>{const l=R.get(e);return q.toExtensionContext(l.port,{status:"delivered",receipt:i}),t(n)},aboutMessageUndeliverability:(i,l)=>{const o=R.get(e);return(o==null?void 0:o.fingerprint)===r&&q.toExtensionContext(o.port,{status:"undeliverable",resolvedDestination:i,message:l}),t(n)},whenDeliverableTo:i=>{const l=()=>{const o=R.get(e);if((o==null?void 0:o.fingerprint)===r&&R.has(i))return q.toExtensionContext(o.port,{status:"deliverable",deliverableTo:i}),!0};if(!l()){const o=Ee(i,l);ve(r,o)}return t(n)},aboutSessionEnded:i=>{const l=R.get(e);return(l==null?void 0:l.fingerprint)===r&&q.toExtensionContext(l.port,{status:"terminated",fingerprint:i}),t(n)}};return n}}),Ye=Ne(),ee=Ge("background",e=>{var r;if(e.origin.context==="background"&&["content-script","devtools "].includes(e.destination.context)&&!e.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const t=K($($({},e.origin),e.origin.context==="window"&&{context:"content-script"})),n=K(ae($($({},e.destination),e.destination.context==="window"&&{context:"content-script"}),{tabId:e.destination.tabId||e.origin.tabId}));e.destination.tabId=null,e.destination.frameId=null;const i=()=>R.get(n),l=()=>R.get(t),o=()=>{var g;D(n).withFingerprint(i().fingerprint).aboutIncomingMessage(e);const u={message:e,to:i().fingerprint,from:{endpointId:t,fingerprint:(g=l())==null?void 0:g.fingerprint}};e.messageType==="message"&&G.add(u),e.messageType==="reply"&&G.remove(e.messageID),l()&&D(t).withFingerprint(l().fingerprint).aboutSuccessfulDelivery(u)};(r=i())!=null&&r.port?o():e.messageType==="message"&&(e.origin.context==="background"?Ee(n,o):l()&&D(t).withFingerprint(l().fingerprint).aboutMessageUndeliverability(n,e).and().whenDeliverableTo(n))},e=>{const r=K($($({},e.origin),e.origin.context==="window"&&{context:"content-script"})),t=R.get(r),n={message:e,to:Ye,from:{endpointId:r,fingerprint:t.fingerprint}};D(r).withFingerprint(t.fingerprint).aboutSuccessfulDelivery(n)});Je.runtime.onConnect.addListener(e=>{var r;const t=$e(e.name);if(!t)return;t.endpointName||(t.endpointName=K({context:"content-script",tabId:e.sender.tab.id,frameId:e.sender.frameId}));const{tabId:n,frameId:i}=oe(t.endpointName);R.set(t.endpointName,{fingerprint:t.fingerprint,port:e}),(r=V.get(t.endpointName))==null||r.forEach(l=>l()),V.delete(t.endpointName),ve(t.fingerprint,()=>{const l=G.entries().filter(o=>o.to===t.fingerprint);G.remove(l),l.forEach(o=>{o.from.endpointId==="background"?ee.endTransaction(o.message.transactionId):D(o.from.endpointId).withFingerprint(o.from.fingerprint).aboutSessionEnded(t.fingerprint)})}),e.onDisconnect.addListener(()=>{var l,o;((l=R.get(t.endpointName))==null?void 0:l.fingerprint)===t.fingerprint&&R.delete(t.endpointName),(o=Q.get(t.fingerprint))==null||o.forEach(g=>g()),Q.delete(t.fingerprint)}),e.onMessage.addListener(l=>{var o,g;if(l.type==="sync"){const u=[...R.values()].map(d=>d.fingerprint),b=l.pendingResponses.filter(d=>u.includes(d.to));G.add(...b),l.pendingResponses.filter(d=>!u.includes(d.to)).forEach(d=>D(t.endpointName).withFingerprint(t.fingerprint).aboutSessionEnded(d.to)),l.pendingDeliveries.forEach(d=>D(t.endpointName).withFingerprint(t.fingerprint).whenDeliverableTo(d));return}l.type==="deliver"&&((g=(o=l.message)==null?void 0:o.origin)!=null&&g.context)&&(l.message.origin.tabId=n,l.message.origin.frameId=i,ee.handleMessage(l.message))})});var{sendMessage:x,onMessage:M}=ee;He(ee);const Te="https://dolphin-app-ys43m.ondigitalocean.app/api";function fr(e,r){}async function Ke(e,r,t){try{const n=new Headers({"Content-Type":"application/json"});t&&n.append("Authorization",`Bearer ${t}`);const i=await fetch(`${Te}/screenshot`,{method:"POST",headers:n,body:JSON.stringify({screenshotBase64:e.dataUrl,targetLang:r,className:e.className})});return i.ok||void 0,await i.json()}catch{}}async function Xe(e,r,t,n,i,l){try{const o=new Headers({"Content-Type":"application/json"});l&&o.append("Authorization",`Bearer ${l}`);const g=await fetch(`${Te}/translate`,{method:"POST",headers:o,body:JSON.stringify({websiteUrl:e,imageBase64:r,targetLang:i,imageUrl:t}),signal:n});return g.ok||void 0,await g.json()}catch{}}function Se(e){return new Promise(r=>{chrome.declarativeNetRequest.updateSessionRules(e,r)})}const Qe="support@scan-translator.com",er="https://scan-translator.com",S={CREDITS_LIMIT_EXCEEDED:'You have exceeded your weekly limit of 30 free credits. Please upgrade to <a href="https://scan-translator.com/#pricing" target="_blank">pro</a> or try again in 1 week.',VPN_DETECTED:"VPN detected. Please disable your VPN and try again",SERVER_ERROR:`An error occurred on the server. Please try again later or contact us at <b>${Qe}</b>`,SITE_NOT_SUPPORTED:`This website is not supported. Please disable Auto Translate, refresh the page and use the <b>Screenshot button</b> or use our <a href="${er}/manga-translator" target="_blank">Manga translator</a> tool instead`,IMAGE_NOT_SUPPORTED:"This site have wrong image format that can't be translated. Only JPEG, PNG, WEBP are supported. Use the <b>Screenshot button</b> instead",INVALID_CREDENTIALS:"Invalid credentials",RELOAD_PAGE:"An error occurred for this image. Please reload the page and try again",VERIFY_EMAIL_FIRST:"Please verify your email first",IMAGE_SIZE_TOO_LARGE:"Image size too large. Use the <b>Screenshot button</b> instead",SERVER_ON_MAINTENANCE:"Server is under maintenance, sorry for the inconvenience. Please try again later"},ge=new Set,re=new Map,H=new Map;let Z="en",rr=1;I.storage.onChanged.addListener(async(e,r)=>{const t=await te();if(r==="local"&&e.enabledCustomFontSize){const n=e.enabledCustomFontSize.newValue||!1;t&&await x("update-enabled-custom-font-size",{enabledCustomFontSize:n},`content-script@${t}`)}if(r==="local"&&e.customFontSize){const n=e.customFontSize.newValue||"16";t&&await x("update-custom-font-size",{customFontSize:n},`content-script@${t}`)}r==="local"&&e.targetLang&&(Z=e.targetLang.newValue||"en",t&&await x("update-target-lang",{targetLang:Z},`content-script@${t}`)),r==="local"&&e.autoTranslatePreferences&&t&&I.tabs.reload(t)}),I.tabs.onUpdated.addListener(async(e,r,t)=>{if(r.status==="complete"&&t.active){if(ge.has(e))return;try{lr(),await x("reset-content-script",{},`content-script@${e}`)}catch{}await _e(),ge.add(e),setTimeout(()=>ge.delete(e),300)}}),M("capture-selected-area",async({data:e})=>{const r=await te();if(!r)throw new Error("No tabId found");try{const t=await tr(e.captureSelectedArea);if(!t){return}await x("display-screen-loading",{className:t.className},`content-script@${r}`);const n=await ce("accessToken"),i=await Ke(t,Z,n);if(!i){await x("remove-loading",{},`content-script@${r}`);return}if(i.statusCode&&!le(i.statusCode))return i.statusCode===503?(await x("display-error-message",{message:S.SERVER_ON_MAINTENANCE,currentIndex:0},`content-script@${r}`),i):i.statusCode===413?(await x("display-error-message",{message:S.IMAGE_SIZE_TOO_LARGE,currentIndex:0},`content-script@${r}`),i):i.statusCode===403?(await x("display-error-message",{message:S.VPN_DETECTED,currentIndex:0},`content-script@${r}`),i):i.statusCode===402?(await x("display-error-message",{message:S.CREDITS_LIMIT_EXCEEDED,currentIndex:0},`content-script@${r}`),i):i.statusCode===401&&i.message==="Please verify your email first"?(await x("display-error-message",{message:S.VERIFY_EMAIL_FIRST,currentIndex:0},`content-script@${r}`),i):i.statusCode===400?(await x("display-error-message",{message:S.RELOAD_PAGE,currentIndex:0},`content-script@${r}`),i):(await x("display-error-message",{message:S.SERVER_ERROR,currentIndex:0},`content-script@${r}`),i);await x("display-screenshot-translation-results",{translationResults:i},`content-script@${r}`)}catch{}finally{await x("remove-loading",{},`content-script@${r}`)}}),M("start-translate-all-images-process",async()=>{const e=await j();if(!(!e||!e.id||!e.url))try{await x("get-all-images",{},`content-script@${e.id}`)}catch{}}),M("start-screenshot-process",async()=>{const e=await j();if(!(!e||!e.id||!e.url))try{await I.storage.local.set({autoTranslatePreferences:!1}),await x("open-screenshot-modal",{openScreenshotModal:!0},`content-script@${e.id}`)}catch(r){console.error("Erreur lors de la capture d'écran :",r)}}),M("get-access-token",async()=>{const e=await ce("accessToken");e&&await x("send-access-token",{accessToken:e},"popup")}),M("store-user-email",async({data:e})=>{const{email:r}=e;await I.storage.local.set({email:r})}),M("store-access-token",async({data:e})=>{const{accessToken:r}=e;mr("accessToken",r,864e6)}),M("remove-access-token",async()=>{await I.storage.local.remove("accessToken")}),M("update-target-lang",async({data:e})=>{const{targetLang:r}=e;await I.storage.local.set({targetLang:r})}),M("update-enabled-custom-font-size",async({data:e})=>{const{enabledCustomFontSize:r}=e;await I.storage.local.set({enabledCustomFontSize:r})}),M("update-custom-font-size",async({data:e})=>{const{customFontSize:r}=e;await I.storage.local.set({customFontSize:r})}),M("get-auto-translate-status",async()=>{const e=await j(),r=await nr(e),t=await Ce(r);await x("auto-translate-status-response",{autoTranslate:t},"popup")}),M("update-auto-translate-preference",async({data:e})=>{const{hostname:r,enabled:t}=e,n=(await I.storage.local.get("autoTranslatePreferences")).autoTranslatePreferences||{};n[r]=t,await I.storage.local.set({autoTranslatePreferences:n}),t&&await _e()}),M("translate-images-data",async({data:e})=>{const{imagesData:r}=e;await ar(r)});async function tr(e){const{top:r,left:t,height:n,width:i,className:l}=e,o=await j();if(!o||!o.id)return null;const g=await I.tabs.captureVisibleTab(o.windowId,{format:"png"});if(!g)return null;const u=await I.tabs.getZoom(o.id),d=await(await fetch(g)).blob(),C=new OffscreenCanvas(i,n),P=C.getContext("bitmaprenderer"),T=await createImageBitmap(d,t*u,r*u,i*u,n*u);if(!P)return null;P.transferFromImageBitmap(T);const E=await C.convertToBlob();return{dataUrl:await Ie(E),className:l,zoomFactor:u}}async function sr(){try{Z=(await I.storage.local.get("targetLang")).targetLang||"en"}catch{}}async function te(){const e=await I.tabs.query({active:!0,currentWindow:!0});return e.length>0?e[0].id:void 0}async function j(){const e=await I.tabs.query({active:!0,currentWindow:!0});return e.length>0?e[0]:void 0}async function nr(e){return e!=null&&e.url?new URL(e.url).hostname:""}async function Ce(e){return((await I.storage.local.get("autoTranslatePreferences")).autoTranslatePreferences||{})[e]||!1}async function _e(){const e=await j();if(!e||!e.id||!e.url)return;const r=new URL(e.url).hostname,t=await Ce(r);if(t)try{await x("get-images",{autoTranslateForTab:t},`content-script@${e.id}`)}catch{}}async function ar(e){const r=await te(),t=await j(),n=t==null?void 0:t.url;if(r===void 0||n===void 0)return;const i=await ce("accessToken");for(let l=0;l<e.length;l++){const o=await j();if(!o||o.id!==r||o.url!==n)break;try{const g=e[l],u=await or(g,l,i);if(u&&"statusCode"in u&&u.statusCode)break}catch{break}}}async function or(e,r,t){const n=await te();if(!n)throw new Error("No tabId found");const i=new AbortController,l=new AbortController;re.set(r,{image:i,translate:l});try{if(e.height>16e3){await x("display-error-message",{message:S.IMAGE_SIZE_TOO_LARGE,currentIndex:r},`content-script@${n}`);return}const o=await ir(e,i.signal);if(!le(o.status)){await x("display-error-message",{message:S.SITE_NOT_SUPPORTED,currentIndex:r},`content-script@${n}`);return}const g=await o.blob();if(!await gr(g)){await x("display-error-message",{message:S.IMAGE_SIZE_TOO_LARGE,currentIndex:r},`content-script@${n}`);return}if(!cr(g.type)){await x("display-error-message",{message:S.IMAGE_NOT_SUPPORTED,currentIndex:r},`content-script@${n}`);return}const b=await Ie(g),d=await Xe(e.websiteUrl,b,e.src,l.signal,Z,t);if(!d){await x("remove-loading",{},`content-script@${n}`);return}return d.statusCode&&!le(d.statusCode)?d.statusCode===503?(await x("display-error-message",{message:S.SERVER_ON_MAINTENANCE,currentIndex:r},`content-script@${n}`),d):d.statusCode===413?(await x("display-error-message",{message:S.IMAGE_SIZE_TOO_LARGE,currentIndex:r},`content-script@${n}`),d):d.statusCode===403?(await x("display-error-message",{message:S.VPN_DETECTED,currentIndex:r},`content-script@${n}`),d):d.statusCode===402?(await x("display-error-message",{message:S.CREDITS_LIMIT_EXCEEDED,currentIndex:r},`content-script@${n}`),d):d.statusCode===401&&d.message==="Please verify your email first"?(await x("display-error-message",{message:S.VERIFY_EMAIL_FIRST,currentIndex:0},`content-script@${n}`),d):d.statusCode===400?(await x("display-error-message",{message:S.RELOAD_PAGE,currentIndex:r},`content-script@${n}`),d):(await x("display-error-message",{message:S.SERVER_ERROR,currentIndex:r},`content-script@${n}`),d):(await x("display-translation-results",{translationResults:d},`content-script@${n}`),d)}catch(o){o instanceof Error&&o.name}finally{re.delete(r)}}async function ir(e,r){const t="modifyHeaders",n="set",i="xmlhttprequest",l=e.src,o=e.websiteUrl,g=new URL(o).origin,u=new URL(l).pathname,b=new URL(l).hostname;Ar(b,u,{id:ur(),priority:1,action:{type:t,requestHeaders:[{header:"referer",operation:n,value:g},{header:"path",operation:n,value:u}]},condition:{urlFilter:b??"",resourceTypes:[i]}});try{const d=await fetch(l,{signal:r,mode:"no-cors"});return me(b,u),d}catch(d){throw d}finally{me(b,u)}}async function gr(e){if(!e)throw new Error("No image provided");return e.size<=5242880}async function Ie(e){return new Promise((r,t)=>{const n=new FileReader;n.onloadend=()=>{r(n.result)},n.onerror=()=>t(n.error),n.readAsDataURL(e)})}function lr(){re.forEach((e,r)=>{e.image.abort(),e.translate.abort()}),re.clear()}function le(e){return e>=200&&e<400}function cr(e){return["image/jpeg","image/png","image/webp"].includes(e)}function mr(e,r,t){const i={value:r,expiry:new Date().getTime()+t};chrome.storage.local.set({[e]:i})}function ce(e){return new Promise((r,t)=>{chrome.storage.local.get(e,n=>{if(!n[e])return r(null);const i=n[e];return new Date().getTime()>i.expiry?(chrome.storage.local.remove(e),r(null)):r(i.value)})})}function ke(e,r){return`${e}${r}`}function Ar(e,r,t){const n=ke(e,r);Se({addRules:[t]}).then(()=>{H.set(n,{id:t.id,lastUsed:Date.now()})})}function me(e,r){const t=ke(e,r);if(H.has(t)){const n=H.get(t);if(!n)return;Se({removeRuleIds:[n.id]}).then(()=>H.delete(t)).catch(i=>void 0)}}function ur(){return rr++}function dr(){const e=Date.now(),r=10*60*1e3;H.forEach((t,n)=>{e-t.lastUsed>r&&me(n.split("domainPartHere")[0],n.split("pathPartHere")[1])})}setInterval(dr,6e4),sr()})();
